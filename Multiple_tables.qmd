---
title: "Multiple table"
author: "Marine MARTINEZ"
format: html
---

```{r}
here::i_am("git-101-2024.Rproj")
library(ggplot2)
library(vroom)
library(here)
library(dplyr)
library(tidyr)
```

We want to load the supplyier, the category and products. So it will be complete to describe the products. 

## Primary key: 
```{r}
products <- vroom(here("northwind", "northwind","Products.csv"))
```
The product id column is the primary key of the product table. A primary key is unique, and we can't have missing value. 
```{r}
pid_nb <-
  products |>
  select(ProductID)|>
  filter(!is.na(ProductID) & !is.nan(ProductID))|>
  distinct(ProductID)|>
  nrow()
```
Enleve les variables qui sont NA. And remove things that are not numbers.We want to know if product id is going to be a primary key, c'est le cas si  : donne TRUE.

Is `ProductID` a valid **primary key**: `r pid_nb == nrow(products)`. 

## Foreign keys: 
```{r}
library(readr)
categories <- read_csv(here("northwind", "northwind","Categories.csv"),
                       col_types = "icc-")
```

Is `CategoryID` column is the  **primary key** of the `categories` table. The `products` table has a `CategoryID`column which is likelu to be a **foreing key** referencing the primery fey of `categories`

## Join:
A **join** operation is a way to combine two tables into a single one by selecting a subset of the cartesian product between two tables. 
The ** natural join* selects only pairs of tuples (row of the column) that have the sale values en the columns that have the same name. `inner join`in dplyr implements by default the natural joint. 

```{r}
p_c <-
  products|>
  inner_join(categories)
```
The 2nd tables is the first argument in inner join.

```{r}
products |>
  mutate(CategoryID= CategoryID-1)|>
  inner_join(categories)
```
It takes out the products of the category 1, there are only 65 observations, the 12 missing were the one where the category changed. In this case as expected, tuples with no match are removed from the result. In this case, tuples with no match are removed from the result. 
We can verify that `category ID`is a foreign key by counting the number of tuples in the result. Here this is : `r nom(p_c)== nrow(products)`. 






